<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Stuart Baumann &amp; Margaryta Klymak" />

<meta name="date" content="2021-09-09" />

<title>Schumaker Spline</title>

<script src="data:application/javascript;base64,Ly8gUGFuZG9jIDIuOSBhZGRzIGF0dHJpYnV0ZXMgb24gYm90aCBoZWFkZXIgYW5kIGRpdi4gV2UgcmVtb3ZlIHRoZSBmb3JtZXIgKHRvCi8vIGJlIGNvbXBhdGlibGUgd2l0aCB0aGUgYmVoYXZpb3Igb2YgUGFuZG9jIDwgMi44KS4KZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGZ1bmN0aW9uKGUpIHsKICB2YXIgaHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCJkaXYuc2VjdGlvbltjbGFzcyo9J2xldmVsJ10gPiA6Zmlyc3QtY2hpbGQiKTsKICB2YXIgaSwgaCwgYTsKICBmb3IgKGkgPSAwOyBpIDwgaHMubGVuZ3RoOyBpKyspIHsKICAgIGggPSBoc1tpXTsKICAgIGlmICghL15oWzEtNl0kL2kudGVzdChoLnRhZ05hbWUpKSBjb250aW51ZTsgIC8vIGl0IHNob3VsZCBiZSBhIGhlYWRlciBoMS1oNgogICAgYSA9IGguYXR0cmlidXRlczsKICAgIHdoaWxlIChhLmxlbmd0aCA+IDApIGgucmVtb3ZlQXR0cmlidXRlKGFbMF0ubmFtZSk7CiAgfQp9KTsK"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<link rel="stylesheet" href="data:text/css,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" type="text/css" />




</head>

<body>




<h1 class="title toc-ignore">Schumaker Spline</h1>
<h4 class="author">Stuart Baumann &amp; Margaryta Klymak</h4>
<h4 class="date">2021-09-09</h4>



<p>This package implements the schumaker spline for one dimensional interpolation. This is the first publicly available R package to give a shape-constrained spline without any optimisation being necessary. It also has significant speed advantages compared to the other shape constrained splines. It is intended for use in dynamic programming problems and in other cases where a simple shape constrained spline is useful.</p>
<p>This vignette first illustrates that the base splines can deliver nonconcave splines from concave data. It follows by describing the options that the schumaker spline provides. It then describes a consumption smoothing problem before illustrating why the schumaker spline performs significantly better than existing splines in these applications.</p>
<p>Finally the speed of this spline in comparison with other splines is described.</p>
<div id="the-schumaker-spline-and-base-splines" class="section level2">
<h2>The schumaker spline and base splines</h2>
<p>We can show that base splines are not shape preserving. Plotting the base monotonic spline (you can experiment with the other ones for a similar result):</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">seq</span>(<span class="dv">1</span>,<span class="dv">10</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">=</span> <span class="fu">log</span>(x)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>xarray <span class="ot">=</span> <span class="fu">seq</span>(<span class="dv">1</span>,<span class="dv">10</span>,<span class="fl">0.01</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>BaseSpline <span class="ot">=</span> <span class="fu">splinefun</span>(x,y, <span class="at">method =</span> <span class="st">&quot;monoH.FC&quot;</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>Base0 <span class="ot">=</span> <span class="fu">BaseSpline</span>(xarray)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>DerivBaseSpline <span class="ot">=</span> <span class="fu">splinefun</span>(xarray, numDeriv<span class="sc">::</span><span class="fu">grad</span>(BaseSpline, xarray))</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>Base1 <span class="ot">=</span> <span class="fu">DerivBaseSpline</span>(xarray)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>Deriv2BaseSpline <span class="ot">=</span> <span class="fu">splinefun</span>(xarray, numDeriv<span class="sc">::</span><span class="fu">grad</span>(DerivBaseSpline, xarray))</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>Base2 <span class="ot">=</span> <span class="fu">Deriv2BaseSpline</span>(xarray)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(xarray, Base0, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">col =</span> <span class="dv">4</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">3</span>), <span class="at">main =</span> <span class="st">&quot;Base Spline and first two derivatives&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Spline and derivatives&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;x&quot;</span>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(xarray, Base1, <span class="at">col =</span> <span class="dv">2</span>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(xarray, Base2, <span class="at">col =</span> <span class="dv">3</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="dv">1</span>)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x=</span><span class="fu">rep</span>(<span class="dv">8</span>,<span class="dv">8</span>,<span class="dv">8</span>), <span class="at">y=</span><span class="fu">c</span>(<span class="dv">2</span>, <span class="fl">0.5</span>,<span class="sc">-</span><span class="fl">0.2</span>), <span class="at">pos=</span><span class="dv">4</span>, <span class="at">labels=</span><span class="fu">c</span>(<span class="st">&#39;Spline&#39;</span>, <span class="st">&#39;First Derivative&#39;</span>, <span class="st">&#39;Second Derivative&#39;</span>))</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --> Here you can see that the first derivative is always positive - the spline is monotonic. However the second derivative moves above and below 0. The spline is not globally concave.</p>
<p>Now we can show the schumaker spline:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(schumaker)</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>SchumSpline <span class="ot">=</span> schumaker<span class="sc">::</span><span class="fu">Schumaker</span>(x,y)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>Schum0 <span class="ot">=</span> SchumSpline<span class="sc">$</span><span class="fu">Spline</span>(xarray)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>Schum1 <span class="ot">=</span> SchumSpline<span class="sc">$</span><span class="fu">DerivativeSpline</span>(xarray)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>Schum2 <span class="ot">=</span> SchumSpline<span class="sc">$</span><span class="fu">SecondDerivativeSpline</span>(xarray)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(xarray, Schum0, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">col =</span> <span class="dv">4</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">3</span>), <span class="at">main =</span> <span class="st">&quot;Schumaker Spline and first two derivatives&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Spline and derivatives&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;x&quot;</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(xarray, Schum1, <span class="at">col =</span> <span class="dv">2</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(xarray, Schum2, <span class="at">col =</span> <span class="dv">3</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="dv">1</span>)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x=</span><span class="fu">rep</span>(<span class="dv">8</span>,<span class="dv">8</span>,<span class="dv">8</span>), <span class="at">y=</span><span class="fu">c</span>(<span class="dv">2</span>, <span class="fl">0.5</span>,<span class="sc">-</span><span class="fl">0.2</span>), <span class="at">pos=</span><span class="dv">4</span>, <span class="at">labels=</span><span class="fu">c</span>(<span class="st">&#39;Spline&#39;</span>, <span class="st">&#39;First Derivative&#39;</span>, <span class="st">&#39;Second Derivative&#39;</span>))</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>Here the second derivative is always negative - the spline is globally concave as well as monotonic.</p>
</div>
<div id="optional-settings" class="section level2">
<h2>Optional Settings</h2>
<p>There are three optional setting in creating a spline. Firstly the gradients at each of the (x,y) points can be input to give more accuracy. If not supplied these are estimated from the points.</p>
<p>Secondly if Vectorised = TRUE arrays can be input to the spline. If arrays will never be input to the spline then you can set Vectorised = FALSE for a small speed improvement (about 30%).</p>
<p>There are three options for out of sample prediction.</p>
<ul>
<li><p>Curve - This is where the quadratic curve that is present in the first and last interval are used to predict points before the first interval and after the last interval respectively.</p></li>
<li><p>Linear - This is where a line is extended out before the first interval and after the last interval. The slope of the line is given by the derivative at the start of the first interval and end of the last interval.</p></li>
<li><p>Constant - This is where the first and last y values are used for prediction before the first point of the interval and after the last part of the interval respectively.</p></li>
</ul>
<p>The three out of sample options are shown below. Here you can see in black the curve is extended out. In green the ends are extrapolated linearly whilst red has constant extrapolation. Note that there is no difference between the 3 within sample.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">seq</span>(<span class="dv">1</span>,<span class="dv">10</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">=</span> <span class="fu">log</span>(x)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>xarray <span class="ot">=</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">5</span>,<span class="dv">15</span>,<span class="fl">0.01</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>SchumSplineCurve    <span class="ot">=</span> <span class="fu">Schumaker</span>(x,y, <span class="at">Extrapolation =</span> <span class="st">&quot;Curve&quot;</span>   )<span class="sc">$</span>Spline</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>SchumSplineConstant <span class="ot">=</span> <span class="fu">Schumaker</span>(x,y, <span class="at">Extrapolation =</span> <span class="st">&quot;Constant&quot;</span>)<span class="sc">$</span>Spline</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>SchumSplineLinear   <span class="ot">=</span> <span class="fu">Schumaker</span>(x,y, <span class="at">Extrapolation =</span> <span class="st">&quot;Linear&quot;</span>  )<span class="sc">$</span>Spline</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>SchumSplineCurveVals    <span class="ot">=</span> <span class="fu">SchumSplineCurve</span>(xarray)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>SchumSplineConstantVals <span class="ot">=</span> <span class="fu">SchumSplineConstant</span>(xarray)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>SchumSplineLinearVals   <span class="ot">=</span> <span class="fu">SchumSplineLinear</span>(xarray)</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(xarray, SchumSplineCurveVals, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">col =</span> <span class="dv">1</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>,<span class="dv">5</span>),</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Ways of predicting outside of sample&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Spline value&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;x&quot;</span>)</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(xarray, SchumSplineConstantVals, <span class="at">col =</span> <span class="dv">2</span>)</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(xarray, SchumSplineLinearVals, <span class="at">col =</span> <span class="dv">3</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>Finally there is the possibility to set the edge gradients manually whilst imputing all of the other gradients. This is done through the edgeGradients setting. By default this setting is c(NA,NA) which means that the default gradients specified in Judd (1998) are used. If this setting is set to c(0,NA) this replaces the left side gradient with a zero gradient. Both edge gradients or only the right gradient can be set analogously.</p>
<p>This edgeGradients can be used to solve a nonmonotonicity problem caused by edge segments that only increase or decrease by a small amount. For instance in the below case, gradient imputation causes nonmonotonicity (while convexity is retained). <a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>,<span class="sc">-</span><span class="dv">1</span>,<span class="sc">-</span><span class="fl">0.5</span>,<span class="dv">0</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.007</span>, <span class="dv">2</span>, <span class="dv">5</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>sp_all <span class="ot">=</span> <span class="fu">Schumaker</span>(x,y)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>sp <span class="ot">=</span> sp_all<span class="sc">$</span>Spline</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>sp1 <span class="ot">=</span> sp_all<span class="sc">$</span>DerivativeSpline</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>sp2 <span class="ot">=</span> sp_all<span class="sc">$</span>SecondDerivativeSpline</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>xarray <span class="ot">=</span> <span class="fu">seq</span>(<span class="fu">min</span>(x), <span class="fu">max</span>(x), <span class="at">length.out =</span> <span class="dv">500</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>yarray0 <span class="ot">=</span> <span class="fu">sp</span>(xarray)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x,y, <span class="at">col =</span> <span class="dv">1</span>)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(xarray,yarray0, <span class="at">col =</span> <span class="dv">2</span>)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>yarray1 <span class="ot">=</span> <span class="fu">sp1</span>(xarray)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(xarray,yarray1, <span class="at">col =</span> <span class="dv">3</span>)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>yarray2 <span class="ot">=</span> <span class="fu">sp2</span>(xarray)</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(xarray,yarray2, <span class="at">col =</span> <span class="dv">4</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>This can be fixed by using edgeGradients to set the left side gradient to zero:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>,<span class="sc">-</span><span class="dv">1</span>,<span class="sc">-</span><span class="fl">0.5</span>,<span class="dv">0</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.007</span>, <span class="dv">2</span>, <span class="dv">5</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>sp_all <span class="ot">=</span> <span class="fu">Schumaker</span>(x,y, <span class="at">edgeGradients =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="cn">NA</span>))</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>sp <span class="ot">=</span> sp_all<span class="sc">$</span>Spline</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>sp1 <span class="ot">=</span> sp_all<span class="sc">$</span>DerivativeSpline</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>sp2 <span class="ot">=</span> sp_all<span class="sc">$</span>SecondDerivativeSpline</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>xarray <span class="ot">=</span> <span class="fu">seq</span>(<span class="fu">min</span>(x), <span class="fu">max</span>(x), <span class="at">length.out =</span> <span class="dv">500</span>)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>yarray0 <span class="ot">=</span> <span class="fu">sp</span>(xarray)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x,y, <span class="at">col =</span> <span class="dv">1</span>)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(xarray,yarray0, <span class="at">col =</span> <span class="dv">2</span>)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>yarray1 <span class="ot">=</span> <span class="fu">sp1</span>(xarray)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(xarray,yarray1, <span class="at">col =</span> <span class="dv">3</span>)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>yarray2 <span class="ot">=</span> <span class="fu">sp2</span>(xarray)</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(xarray,yarray2, <span class="at">col =</span> <span class="dv">4</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
<div id="speeding-up-using-multiple-functions-for-interpolations-for-various-groups." class="section level2">
<h2>Speeding up using multiple functions for interpolations for various groups.</h2>
<p>Consider we have a dataframe with x and y variables for multiple different groups. We want to interpolate using this dataframe. We need a different approximation function for each group. The schumaker package implements a way to do this. For every group present in the dataframe a new function is created. A function that calls the correct interpolation function is returned.</p>
<p>As an example consider we have some equity prices for several stocks, several days and several times of the day. We want to be able to interpolate for other times. First generating some example data.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>RICs <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;BARC.L&quot;</span>, <span class="st">&quot;VOD.L&quot;</span>, <span class="st">&quot;IBM.L&quot;</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>Dates <span class="ot">=</span> <span class="fu">as.Date</span>(<span class="fu">c</span>(<span class="st">&quot;11-11-2019&quot;</span>, <span class="st">&quot;12-11-2019&quot;</span>, <span class="st">&quot;13-11-2019&quot;</span>, <span class="st">&quot;14-11-2019&quot;</span>, <span class="st">&quot;15-11-2019&quot;</span>), <span class="at">format=</span><span class="st">&quot;%d-%m-%Y&quot;</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>times <span class="ot">=</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">28800</span>, <span class="at">length.out =</span> <span class="dv">10</span>) <span class="co"># We are going to interpolate by time of day. This is the x variable. So we state it in terms of seconds. from start of day&#39;s trade.</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>dd <span class="ot">=</span> <span class="fu">expand.grid</span>(<span class="at">TIME =</span> times, <span class="at">Date =</span> Dates, <span class="at">RIC =</span> RICs)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>dd <span class="ot">=</span> <span class="fu">merge</span>(dd, <span class="fu">data.frame</span>(<span class="at">RIC =</span> RICs, <span class="at">PRICE =</span> <span class="fu">c</span>(<span class="fl">160.00</span>, <span class="fl">162.24</span>, <span class="fl">137.24</span>))) <span class="co"># Making example prices. These are not accurate and I am ignoring currency.</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>randomness <span class="ot">=</span> <span class="fu">rlnorm</span>(<span class="fu">dim</span>(dd)[<span class="dv">1</span>])</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>dd<span class="sc">$</span>PRICE <span class="ot">=</span> dd<span class="sc">$</span>PRICE <span class="sc">*</span> <span class="fu">cumprod</span>(randomness)</span></code></pre></div>
<p>Now we can create a function that interpolates for each day and for each stock. Then we can intterpolate to get the interpolated price at the desired time of the day. This is done below, first with the base function approxfun and secondly with a schumaker spline.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>approx_func <span class="ot">=</span> <span class="cf">function</span>(x,y){<span class="fu">approxfun</span>(x, y)}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>dispatched_approxfun <span class="ot">=</span> <span class="fu">make_approx_functions_from_dataframe</span>(dd, <span class="at">group_vars =</span> <span class="fu">c</span>(<span class="st">&quot;RIC&quot;</span>, <span class="st">&quot;Date&quot;</span>), <span class="at">x_var =</span> <span class="st">&quot;TIME&quot;</span>, <span class="at">y_var =</span> <span class="st">&quot;PRICE&quot;</span>, approx_func)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dispatched_approxfun</span>(<span class="st">&quot;BARC.L&quot;</span>, Dates[<span class="dv">2</span>], <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">156</span>, <span class="dv">6045</span>))</span></code></pre></div>
<pre><code>## [1] 1.392587 1.408422 1.686688</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>approx_func <span class="ot">=</span> <span class="cf">function</span>(x,y){<span class="fu">Schumaker</span>(x, y)<span class="sc">$</span>Spline}</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>approxfun_in_lists <span class="ot">=</span> <span class="fu">make_approx_functions_from_dataframe</span>(dd, <span class="at">group_vars =</span> <span class="fu">c</span>(<span class="st">&quot;RIC&quot;</span>, <span class="st">&quot;Date&quot;</span>), <span class="at">x_var =</span> <span class="st">&quot;TIME&quot;</span>, <span class="at">y_var =</span> <span class="st">&quot;PRICE&quot;</span>, approx_func)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dispatched_approxfun</span>(<span class="st">&quot;IBM.L&quot;</span>, Dates[<span class="dv">3</span>], <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">156</span>, <span class="dv">6045</span>))</span></code></pre></div>
<pre><code>## [1] 0.039535420 0.039118110 0.004943805</code></pre>
</div>
<div id="example-a-simple-consumption-smoothing-problem" class="section level2">
<h2>Example: A simple consumption smoothing problem</h2>
<p>Consider a consumer that has a budget of <span class="math inline">\(B_t\)</span> at time <span class="math inline">\(t\)</span> and a periodic income of <span class="math inline">\(1\)</span>. She has a periodic utility function given by:</p>
<p><span class="math inline">\(u_t = \epsilon_t x_t^{0.2}\)</span></p>
<p>where <span class="math inline">\(x_t\)</span> is spending in period <span class="math inline">\(t\)</span> and <span class="math inline">\(\epsilon_t\)</span> is the shock in period <span class="math inline">\(t\)</span> drawn from some stationary nonnegative shock process with pdf <span class="math inline">\(f(\epsilon)\)</span>.</p>
<p>The problem for the consumer in period <span class="math inline">\(t\)</span> is:</p>
<p><span class="math inline">\(V(B_t | \epsilon_{t}) = \max_{0 &lt; x_t &lt; B} \hspace{0.5cm} \epsilon_t x_t^{0.2} + \beta E_t[ V(B_{t+1})]\)</span></p>
<p>Where <span class="math inline">\(\beta\)</span> is a discounting factor and <span class="math inline">\(B_{t+1} = 1 + B_t - x_t\)</span>.</p>
<div id="algorithm" class="section level3">
<h3>Algorithm</h3>
<p>We can first note that due to the shock process it is not possible to get analytical equations to describe the paths of spending and the budget over the long term. We can get a numerical solution however. The key step is to find expressions for the expected value function as a function of <span class="math inline">\(B_{t+1}\)</span>. With this we can run simulations with random shocks to see the long term distributions of <span class="math inline">\(x_t\)</span> and <span class="math inline">\(B_t\)</span>. The algorithm we will use is:</p>
<ol style="list-style-type: decimal">
<li>We discretize the budget statespace.</li>
<li>We make an initial guess of the future value function <span class="math inline">\(E[ V(B_{t+1})]\)</span> at every value of <span class="math inline">\(B_{t+1}\)</span> in our discretized statespace. A deterministic approximation of the problem (assume shocks will be <span class="math inline">\(E[\epsilon_{t}]\)</span> forever) is often good for this.</li>
<li>We use the schumaker spline to join together our estimates at each point in the discretized statespace into an interpolation function.</li>
<li>At every point in the statespace we create updated estimates</li>
</ol>
<ul>
<li>We use a cubature package to estimate <span class="math inline">\(\int^\infty_{0} V(B_t | \epsilon_t ) f(\epsilon_t) d\epsilon_t\)</span></li>
<li>In this integral we use a one dimensional optimizer along with the above equation to evaluate <span class="math inline">\(V(B_t | \epsilon_t )\)</span></li>
</ul>
<ol start="5" style="list-style-type: decimal">
<li>Check your convergence criteria. Are the new <span class="math inline">\(V(B_t | \epsilon_t )\)</span> values very close to the old values?</li>
</ol>
<ul>
<li>If they are we end the algorithm</li>
<li>If they are not we go back to point 3.</li>
</ul>
<p>This strategy relies on the consumption problem being a contraction mapping. This means that if we use this algorithm we will converge to a fixed point function. The FixedPoint package (by the same authors as this package) can be useful here in accelerating the convergence. A more formal presentation of the preeding consumption smoothing problem and the code to solve it can be found in a paper discussing fixed point acceleration in R (Baumann &amp; Klymak 2019).</p>
</div>
<div id="why-a-schumaker-spline-is-necessary" class="section level3">
<h3>Why a schumaker spline is necessary</h3>
<p>There are a few reasons we need the spline to be shape preserving and without optimization to make this work:</p>
<ul>
<li><p>Shape preservation is necessary so the spline is globally concave (the <span class="math inline">\(V(B_t | \epsilon_t )\)</span> values will always be concave as the periodic utility function is always concave). This is necessary for the one dimensional optimisation step. The periodic utility function is concave and the future value function needs to be concave (in <span class="math inline">\(B_{t+1}\)</span>) to guarantee a unique local optima. Other splines can incorporate tiny convexities in the intervals between interpolation points which can lead to multiple local optima.</p></li>
<li><p>There do exist shape preserving splines that incorporate an optimization step (ie scam, cobs). These are not effective for this kind of problem because it is not possible to converge to a fixed point. In each iteration the optimization settles on a slightly different parameter set which means the future value function can “jump around”. In addition the optimization step can take a significant amount of time because evaluations of the future value function spline take longer.</p></li>
</ul>
</div>
</div>
<div id="speed" class="section level2">
<h2>Speed</h2>
<ul>
<li>The schumaker spline is of comparable speed to create as other shape preserving splines.</li>
<li>Compared to other splines (including the base spline), the schumaker spline is faster or roughly equally fast in evaluating points.</li>
</ul>
<p>These benchmarks are available below:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cobs)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scam)</span></code></pre></div>
<pre><code>## Loading required package: mgcv</code></pre>
<pre><code>## Loading required package: nlme</code></pre>
<pre><code>## This is mgcv 1.8-36. For overview type &#39;help(&quot;mgcv-package&quot;)&#39;.</code></pre>
<pre><code>## This is scam 1.2-12.</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">seq</span>(<span class="dv">1</span>,<span class="dv">10</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">=</span> <span class="fu">log</span>(x)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>xarray <span class="ot">=</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">15</span>,<span class="fl">0.01</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>ScamSpline <span class="ot">=</span> <span class="cf">function</span>(dat) {scam<span class="sc">::</span><span class="fu">scam</span>(y<span class="sc">~</span><span class="fu">s</span>(x,<span class="at">k=</span><span class="dv">4</span>,<span class="at">bs=</span><span class="st">&quot;mdcx&quot;</span>,<span class="at">m=</span><span class="dv">1</span>),<span class="at">data=</span>dat)}</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>CobsSpline <span class="ot">=</span> <span class="cf">function</span>(x,y) {cobs<span class="sc">::</span><span class="fu">cobs</span>(x , y, <span class="at">constraint =</span> <span class="fu">c</span>(<span class="st">&quot;decrease&quot;</span>, <span class="st">&quot;convex&quot;</span>), <span class="at">print.mesg =</span> <span class="cn">FALSE</span>)}</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>CreateSplineTest <span class="ot">=</span> rbenchmark<span class="sc">::</span><span class="fu">benchmark</span>(</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replicate</span>(<span class="dv">10</span>, <span class="fu">Schumaker</span>(x,y)),</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replicate</span>(<span class="dv">10</span>,<span class="fu">splinefun</span>(x,y,<span class="st">&quot;monoH.FC&quot;</span>)),</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replicate</span>(<span class="dv">10</span>,<span class="fu">ScamSpline</span>(dat)),</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replicate</span>(<span class="dv">10</span>,<span class="fu">CobsSpline</span>(x,y)),</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">columns =</span> <span class="fu">c</span>(<span class="st">&#39;test&#39;</span>,<span class="st">&#39;elapsed&#39;</span>, <span class="st">&#39;relative&#39;</span>)</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(CreateSplineTest)</span></code></pre></div>
<pre><code>##                                         test elapsed relative
## 4            replicate(10, CobsSpline(x, y))   25.20   1260.0
## 3             replicate(10, ScamSpline(dat))    7.24    362.0
## 1             replicate(10, Schumaker(x, y))   13.81    690.5
## 2 replicate(10, splinefun(x, y, &quot;monoH.FC&quot;))    0.02      1.0</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>BaseSp <span class="ot">=</span>   <span class="fu">splinefun</span>(x,y,<span class="st">&quot;monoH.FC&quot;</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>SchuSp <span class="ot">=</span>   <span class="fu">Schumaker</span>(x,y)<span class="sc">$</span>Spline</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>ScamSp <span class="ot">=</span>   scam<span class="sc">::</span><span class="fu">scam</span>(y<span class="sc">~</span><span class="fu">s</span>(x,<span class="at">k=</span><span class="dv">4</span>,<span class="at">bs=</span><span class="st">&quot;mdcx&quot;</span>,<span class="at">m=</span><span class="dv">1</span>),<span class="at">data=</span>dat)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>CobsSp <span class="ot">=</span>   cobs<span class="sc">::</span><span class="fu">cobs</span>(x , y, <span class="at">constraint =</span> <span class="fu">c</span>(<span class="st">&quot;decrease&quot;</span>, <span class="st">&quot;convex&quot;</span>), <span class="at">print.mesg =</span> <span class="cn">FALSE</span>)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>ScamPr <span class="ot">=</span> <span class="cf">function</span>(x){  scam<span class="sc">::</span><span class="fu">predict.scam</span>(ScamSp,<span class="fu">data.frame</span>(<span class="at">x =</span> x))}</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>CobsPr <span class="ot">=</span> <span class="cf">function</span>(x){  <span class="fu">predict</span>(CobsSp, x)[,<span class="dv">2</span>] }</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>PredictArrayTest <span class="ot">=</span> rbenchmark<span class="sc">::</span><span class="fu">benchmark</span>(</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replicate</span>(<span class="dv">10</span>,<span class="fu">SchuSp</span>(xarray)),</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replicate</span>(<span class="dv">10</span>,<span class="fu">BaseSp</span>(xarray)),</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replicate</span>(<span class="dv">10</span>,<span class="fu">ScamPr</span>(xarray)),</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replicate</span>(<span class="dv">10</span>,<span class="fu">CobsPr</span>(xarray)),</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">columns =</span> <span class="fu">c</span>(<span class="st">&#39;test&#39;</span>,<span class="st">&#39;elapsed&#39;</span>, <span class="st">&#39;relative&#39;</span>)</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(PredictArrayTest)</span></code></pre></div>
<pre><code>##                            test elapsed relative
## 2 replicate(10, BaseSp(xarray))    0.11    1.833
## 4 replicate(10, CobsPr(xarray))    0.07    1.167
## 3 replicate(10, ScamPr(xarray))    2.11   35.167
## 1 replicate(10, SchuSp(xarray))    0.06    1.000</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>SchuSp <span class="ot">=</span>   <span class="fu">Schumaker</span>(x,y, <span class="at">Vectorise =</span> <span class="cn">FALSE</span>)<span class="sc">$</span>Spline</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>PredictPointTest <span class="ot">=</span> rbenchmark<span class="sc">::</span><span class="fu">benchmark</span>(</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replicate</span>(<span class="dv">100</span>,<span class="fu">SchuSp</span>(<span class="fu">runif</span>(<span class="dv">1</span>))),</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replicate</span>(<span class="dv">100</span>,<span class="fu">BaseSp</span>(<span class="fu">runif</span>(<span class="dv">1</span>))),</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replicate</span>(<span class="dv">100</span>,<span class="fu">ScamPr</span>(<span class="fu">runif</span>(<span class="dv">1</span>))),</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replicate</span>(<span class="dv">100</span>,<span class="fu">CobsPr</span>(<span class="fu">runif</span>(<span class="dv">1</span>))),</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">columns =</span> <span class="fu">c</span>(<span class="st">&#39;test&#39;</span>,<span class="st">&#39;elapsed&#39;</span>, <span class="st">&#39;relative&#39;</span>)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(PredictPointTest)</span></code></pre></div>
<pre><code>##                               test elapsed relative
## 2 replicate(100, BaseSp(runif(1)))    0.19      3.8
## 4 replicate(100, CobsPr(runif(1)))    0.28      5.6
## 3 replicate(100, ScamPr(runif(1)))   11.39    227.8
## 1 replicate(100, SchuSp(runif(1)))    0.05      1.0</code></pre>
</div>
<div id="reference" class="section level2">
<h2>Reference</h2>
<p>The original reference is:</p>
<p>Schumaker, L.L. 1983. On shape-preserving quadratic spline interpolation. SIAM Journal of Numerical Analysis 20: 854-64.</p>
<p>The key reference used to write this package is Kenneth L. Judd’s textbook entitled Numerical Methods in Economics (1998). This presents precisely how to create the spline and it is simple to reconcile the code with the equations from this book. This book also gives more detail on solving dynamic control problems. A further reference which advocates the use of the schumaker spline is Ljungqvist and Sargent’s textbook Recursive Economic Theory.</p>
<p>A paper with a more code example of the consumption smoothing problem in R is:</p>
<p>Baumann, S. and Klymak M. 2019. Fixed Point Acceleration in R. The R Journal (2019) 11:1, pages 359-375.</p>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>We thank Hariharan Iyer for bringing this issue to our attention.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
